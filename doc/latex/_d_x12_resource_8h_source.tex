\doxysection{DX12\+Resource.\+h}
\hypertarget{_d_x12_resource_8h_source}{}\label{_d_x12_resource_8h_source}\index{src/DX12Resource.h@{src/DX12Resource.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ "{}includeDX12.h"{}}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ "{}AssertUtils.h"{}}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_d_x12_resource}{DX12Resource}}}
\DoxyCodeLine{00007\ \{}
\DoxyCodeLine{00008\ \ \ \ \ ComPtr<ID3D12Resource>\ resource;}
\DoxyCodeLine{00009\ \ \ \ \ D3D12\_CPU\_DESCRIPTOR\_HANDLE\ cpuDescriptorHandle\ =\ \{\};}
\DoxyCodeLine{00010\ \ \ \ \ D3D12\_GPU\_DESCRIPTOR\_HANDLE\ gpuDescriptorHandle\ =\ \{\};}
\DoxyCodeLine{00011\ }
\DoxyCodeLine{00012\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00013\ \ \ \ \ \textcolor{keywordtype}{void}\ createOrUpdateConstantBuffer(ID3D12Device*\ device,}
\DoxyCodeLine{00014\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ID3D12GraphicsCommandList*\ commandList,}
\DoxyCodeLine{00015\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ T\&\ data,}
\DoxyCodeLine{00016\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ID3D12DescriptorHeap*\ descriptorHeap,}
\DoxyCodeLine{00017\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \&currentlyInitDescriptor)}
\DoxyCodeLine{00018\ \ \ \ \ \{}
\DoxyCodeLine{00019\ \ \ \ \ \ \ \ \ \textcolor{comment}{//TODO\ :\ check\ si\ sizeof(T)\ est\ un\ multiple\ de\ ...\ pour\ le\ padding}}
\DoxyCodeLine{00020\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ UINT64\ bufferSize\ =\ (\textcolor{keyword}{sizeof}(T)\ +\ 255)\ \&\ \string~255;\ \textcolor{comment}{//\ Align\ buffer\ size\ to\ 256\ bytes}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!resource)}
\DoxyCodeLine{00023\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00024\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ the\ constant\ buffer}}
\DoxyCodeLine{00025\ \ \ \ \ \ \ \ \ \ \ \ \ D3D12\_HEAP\_PROPERTIES\ heapProps\ =\ \{\};}
\DoxyCodeLine{00026\ \ \ \ \ \ \ \ \ \ \ \ \ heapProps.Type\ =\ D3D12\_HEAP\_TYPE\_UPLOAD;}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ \ \ \ \ heapProps.CPUPageProperty\ =\ D3D12\_CPU\_PAGE\_PROPERTY\_UNKNOWN;}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ \ \ \ \ heapProps.MemoryPoolPreference\ =\ D3D12\_MEMORY\_POOL\_UNKNOWN;}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \ \ \ \ D3D12\_RESOURCE\_DESC\ bufferDesc\ =\ \{\};}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \ \ \ \ bufferDesc.Dimension\ =\ D3D12\_RESOURCE\_DIMENSION\_BUFFER;}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \ \ \ \ bufferDesc.Width\ =\ bufferSize;}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \ \ \ \ bufferDesc.Height\ =\ 1;}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \ \ \ \ bufferDesc.DepthOrArraySize\ =\ 1;}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ \ \ \ \ bufferDesc.MipLevels\ =\ 1;}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \ \ \ \ bufferDesc.Format\ =\ DXGI\_FORMAT\_UNKNOWN;}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \ \ \ \ bufferDesc.SampleDesc.Count\ =\ 1;}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \ \ \ \ bufferDesc.SampleDesc.Quality\ =\ 0;}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \ \ \ \ bufferDesc.Layout\ =\ D3D12\_TEXTURE\_LAYOUT\_ROW\_MAJOR;}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \ \ \ \ bufferDesc.Flags\ =\ D3D12\_RESOURCE\_FLAG\_NONE;}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \ \ \ \ ThrowIfFailed(device-\/>CreateCommittedResource(}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&heapProps,}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ D3D12\_HEAP\_FLAG\_NONE,}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&bufferDesc,}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ D3D12\_RESOURCE\_STATE\_GENERIC\_READ,}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{nullptr},}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ IID\_PPV\_ARGS(\&resource)}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \ \ \ \ ));}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \ \ \ \ cpuDescriptorHandle\ =\ CD3DX12\_CPU\_DESCRIPTOR\_HANDLE(}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ descriptorHeap-\/>GetCPUDescriptorHandleForHeapStart(),}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ currentlyInitDescriptor++,}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ device-\/>GetDescriptorHandleIncrementSize(D3D12\_DESCRIPTOR\_HEAP\_TYPE\_CBV\_SRV\_UAV)}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \ \ \ \ D3D12\_CONSTANT\_BUFFER\_VIEW\_DESC\ cbvDesc\ =\ \{\};}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \ \ \ \ cbvDesc.BufferLocation\ =\ resource-\/>GetGPUVirtualAddress();}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \ \ \ \ cbvDesc.SizeInBytes\ =\ bufferSize;}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \ \ \ \ device-\/>CreateConstantBufferView(\&cbvDesc,\ cpuDescriptorHandle);}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Map\ and\ update\ the\ buffer}}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}*\ pMappedData\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ D3D12\_RANGE\ readRange\ =\ \{\ 0,\ 0\ \};\ \textcolor{comment}{//\ We\ do\ not\ intend\ to\ read\ from\ this\ buffer}}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ ThrowIfFailed(resource-\/>Map(0,\ \&readRange,\ \&pMappedData));}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ std::memcpy(pMappedData,\ \&data,\ \textcolor{keyword}{sizeof}(T));}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ resource-\/>Unmap(0,\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00074\ \ \ \ \ \}}
\DoxyCodeLine{00075\ \};}

\end{DoxyCode}
